<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.buskers.repository.mapper.AgencyMapper">
	
<!-- 	<select id="selectAgencyInfo" resultType="agencyInfo"> -->
<!-- 		select * -->
<!-- 		  from tb_agency_info -->
<!-- 	</select> -->

	<!-- 업체 페이지 페이징 -->
	<select id="selectAgencyInfo" parameterType="agencyPage" resultType="agencyInfo">
		select b.*
 		 from (select @rownum:=@rownum+1 as rnum, a.*
		 		 from ( select *
						   from tb_agency_info
						  order by agency_info_no desc) a, (SELECT @rownum := 0 ) R 
				)  b
 		where rnum between #{begin} and #{end}
	</select>
	<select id="selectAgencyInfoCount" resultType="int">
		select count(*)
		  from tb_agency_info
	</select>
	
	<insert id="insertAgencyInfo" parameterType="agencyInfo">
		<selectKey keyProperty="agencyInfoNo" resultType="int" order="BEFORE">
   			 SELECT MAX(agency_info_no)+1 FROM tb_agency_info
  		</selectKey>
		insert into tb_agency_info(agency_info_no, agency_name, purpose, phone, basic_addr, detail_addr, email, member_no)
		values(#{agencyInfoNo},#{agencyName}, #{purpose}, #{phone}, #{basicAddr}, #{detailAddr}, #{email}, 2)
	</insert>
	
	<insert id="insertAgencyGenre" parameterType="agencyGenre">
		insert into tb_agency_genre(genre_no, agency_info_no)
		values
        <foreach collection="agencyCheckbox" item="genre" separator=" , ">
            (#{genre}, #{agencyInfoNo})
        </foreach>
	</insert>
</mapper>

























