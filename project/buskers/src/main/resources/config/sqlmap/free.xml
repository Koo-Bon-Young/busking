<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.buskers.repository.mapper.FreeBoardMapper">
	
	<select id="selectBoard" parameterType="freePage" resultType="freeBoard">
		select *
  		  from (select @rownum:=@rownum+1 rnum, a.*
		          from ( select *
		                   from tb_freeboard
						  WHERE (@rownum:=0)=0
						  
						<choose>
							<when test="searchType == 'title'">
								and title like concat('%', #{input}, '%')
							</when>
							<when test="searchType == 'content'">
								and content like concat('%', #{input}, '%')
							</when>
							<when test="searchType == 'writer'">
								and writer like concat('%', #{input}, '%')
							</when>
							<otherwise>
							</otherwise>
						</choose>
						
						<choose>
							<when test="sortType == 'viewDESC'">
								order by view_cnt desc
							</when>
							<when test="sortType == 'viewASC'">
								order by view_cnt asc
							</when>
							<when test="sortType == 'likeDESC'">
								order by like_cnt desc
							</when>
							<when test="sortType == 'likeASC'">
								order by like_cnt asc
							</when>
							<when test="sortType == 'dateDESC'">
								order by reg_date desc
							</when>
							<when test="sortType == 'dateASC'">
								order by reg_date asc
							</when>
							<otherwise>
								order by board_no desc
							</otherwise>
						</choose>
						
	                   ) a
		       ) b
		 where rnum between #{begin} and #{end}
	</select>
	
	<select id="selectNoticeBoard" resultType="freeBoard">
		select * 
		  from tb_freeboard
		 where is_notify = 'Y'
	</select>
	
	<select id="selectBoardByNo" parameterType="int" resultType="freeBoard">
		select * 
		  from tb_freeboard
		 where board_no = #{boardNo}
	</select>

	<select id="selectBoardCount" parameterType="freePage" resultType="int">
		select count(*)
		  from tb_freeboard
		<choose>
			<when test="searchType == 'title'">
				where title like concat('%', #{input}, '%')
			</when>
			<when test="searchType == 'content'">
				where content like concat('%', #{input}, '%')
			</when>
			<when test="searchType == 'writer'">
				where writer like concat('%', #{input}, '%')
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<update id="updateBoardViewCount" parameterType="int">
		update tb_freeboard
		  set view_cnt = view_cnt + 1
		where board_no = #{boardNo}
	</update>
</mapper>
